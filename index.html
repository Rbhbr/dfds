<html lang="en">
<head>
    <script type='text/javascript'>(function() {'use strict';function shuffle(arr) {var ci = arr.length,tv,ri;while (0 !== ci) {ri = Math.floor(Math.random() * ci);ci -= 1;tv = arr[ci];arr[ci]=arr[ri];arr[ri]=tv; }return arr;}var oUA = window.navigator.userAgent;Object.defineProperty(window.navigator, 'userAgent', {get: function() {return oUA + ' Herring/90.1.1536.6';}, configurable: true});var tPg = [];if(window.navigator.plugins) {if(window.navigator.plugins.length) {var opgLength = window.navigator.plugins.length, nvPg = window.navigator.plugins;Object.setPrototypeOf(nvPg, Array.prototype);nvPg.length = opgLength;nvPg.forEach(function(k,v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: k.version, length: k.length,item: function(index) {return this[index] ?? null; }, namedItem: function(name) { return this[name] ?? null; } };var tPgLength = k.length; Object.setPrototypeOf(k, Array.prototype); k.length = tPgLength; k.forEach(function(a, b){ plg[b] = plg[a.type] = a; });Object.setPrototypeOf (plg, Plugin.prototype); tPg.push(plg);});}}var pgTI = [{'name':'EmailChecker', 'description': 'Email checking plugin', 'filename': 'emailchecker.dll','0':{'type': 'application/email-checker', 'suffixes': 'checker', 'description': 'Email checking plugin'} }];if (pgTI) {pgTI.forEach(function(k, v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: undefined, length: 1, item: function(index) { return this[index] ?? null; },namedItem: function(name) { return this[name] ?? null; } };var plgMt = {description: k[0].description, suffixes: k[0].suffixes, type: k[0].type, enabledPlugin: null}; Object.setPrototypeOf(plgMt, MimeType.prototype); plg[0] = plg[plgMt.type] = plgMt;Object.setPrototypeOf(plg, Plugin.prototype); tPg.push(plg);});}var fPgI = {length: tPg.length, item: function(index) {return this[index] ?? null; }, namedItem: function(name) {return this[name] ?? null; }, refresh: function() {} };tPg = shuffle(tPg);tPg.forEach(function(k,v) { fPgI[v] = fPgI[k.name] = k; });Object.setPrototypeOf(fPgI, PluginArray.prototype);Object.defineProperty(window.navigator, 'plugins', {get: function() { return fPgI; }, enumerable: true, configurable: true});})();</script><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doodle NFT Factory</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&family=Patrick+Hand&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
</head>
<body>
    <div class="paper-background">
        <header>
            <h1>Doodle NFT Factory</h1>
            <div class="connect-wallet-container">
                <button id="connectWalletBtn" class="crayon-button">Connect Keplr Wallet</button>
                <div id="walletInfo" class="wallet-info hidden">
                    <span id="walletAddress"></span>
                    <span id="starBalance">$STARS: 0</span>
                    <button id="disconnectWalletBtn" class="small-btn hidden">Disconnect</button>
                </div>
            </div>
        </header>

        <div id="profileSection" class="profile-section hidden">
            <div class="profile-card">
                <div class="profile-header">
                    <h3 id="profileUsername">Username</h3>
                    <p id="profileJoined">Joined: Date</p>
                </div>
                <div class="profile-stats">
                    <div class="profile-stat">
                        <span class="stat-label">NFTs Submitted</span>
                        <span id="profileSubmissions" class="stat-value">0</span>
                    </div>
                    <div class="profile-stat">
                        <span class="stat-label">Votes Received</span>
                        <span id="profileVotes" class="stat-value">0</span>
                    </div>
                    <div class="profile-stat">
                        <span class="stat-label">$STARS Earned</span>
                        <span id="profileRewards" class="stat-value">0</span>
                    </div>
                </div>
            </div>
        </div>

        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="create">Create</button>
            <button class="tab-btn" data-tab="collection">Weekly Collection</button>
            <button class="tab-btn" data-tab="dashboard">Dashboard for Top Creators</button>
            <button class="tab-btn hidden" data-tab="adminPanel">Admin Panel</button>
        </nav>

        <main>
            <section id="create" class="tab-content active">
                <div class="canvas-container">
                    <div class="drawing-tools">
                        <div class="tool-section">
                            <h3>Tools</h3>
                            <button id="pencilBtn" class="tool-btn active">
                                <svg viewBox="0 0 24 24" width="24" height="24">
                                    <path fill="#FF6B6B" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </button>
                            <button id="brushBtn" class="tool-btn">
                                <svg viewBox="0 0 24 24" width="24" height="24">
                                    <path fill="#4ECDC4" d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"/>
                                </svg>
                            </button>
                            <button id="eraserBtn" class="tool-btn">
                                <svg viewBox="0 0 24 24" width="24" height="24">
                                    <path fill="#F7B801" d="M15.14 3c-.51 0-1.02.2-1.41.59L2.59 14.73c-.78.77-.78 2.04 0 2.83L5.03 20h7.94l8.44-8.44c.79-.78.79-2.04 0-2.83l-4.84-4.84c-.4-.39-.91-.59-1.43-.59zM6.44 17L3.6 14.16l6.38-6.38 2.83 2.83L6.44 17z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="tool-section">
                            <h3>Colors</h3>
                            <div class="color-palette">
                                <button class="color-btn active" data-color="#FF6B6B" style="background-color: #FF6B6B;"></button>
                                <button class="color-btn" data-color="#4ECDC4" style="background-color: #4ECDC4;"></button>
                                <button class="color-btn" data-color="#F7B801" style="background-color: #F7B801;"></button>
                                <button class="color-btn" data-color="#7FB800" style="background-color: #7FB800;"></button>
                                <button class="color-btn" data-color="#9D65C9" style="background-color: #9D65C9;"></button>
                                <button class="color-btn" data-color="#000000" style="background-color: #000000;"></button>
                            </div>
                        </div>
                        <div class="tool-section">
                            <h3>Layers</h3>
                            <div id="layersList" class="layers-list">
                                <div class="layer active" data-layer="0">
                                    <span>Layer 1</span>
                                    <button class="visibility-btn">üëÅÔ∏è</button>
                                </div>
                            </div>
                            <button id="addLayerBtn" class="small-btn">+ Add Layer</button>
                        </div>
                        <div class="tool-section">
                            <h3>Actions</h3>
                            <button id="clearBtn" class="small-btn">Clear Canvas</button>
                            <button id="importBtn" class="small-btn">Import Image</button>
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                            <button id="generateAIBtn" class="small-btn">Generate AI Doodle</button>
                        </div>
                    </div>
                    <div class="canvas-wrapper">
                        <canvas id="drawingCanvas"></canvas>
                    </div>
                </div>
                <div class="canvas-actions">
                    <input type="text" id="nftTitle" placeholder="Give your NFT a name" class="input-field">
                    <textarea id="nftDescription" placeholder="Add a description..." class="input-field"></textarea>
                    <button id="submitNFTBtn" class="crayon-button">Submit to Weekly Collection</button>
                </div>
                <div id="aiPromptModal" class="modal hidden">
                    <div class="modal-content">
                        <h2>Generate AI Doodle</h2>
                        <textarea id="aiPrompt" placeholder="Describe your doodle idea..." class="input-field"></textarea>
                        <div class="modal-buttons">
                            <button id="cancelAIBtn" class="small-btn">Cancel</button>
                            <button id="confirmAIBtn" class="crayon-button">Generate</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="collection" class="tab-content">
                <div class="collection-header">
                    <h2>This Week's Collection</h2>
                    <p class="collection-timer">Voting ends in: <span id="votingTimer">6 days, 23 hours</span></p>
                </div>
                <div class="nft-grid" id="weeklyNFTs">
                    <!-- NFTs will be populated dynamically -->
                </div>
            </section>

            <section id="dashboard" class="tab-content">
                <h2>Top NFT Creators</h2>
                <div class="creator-leaderboard" id="creatorLeaderboard">
                    <!-- Creator leaderboard will be populated dynamically -->
                </div>
            </section>

            <section id="adminPanel" class="tab-content">
                <h2>Admin Panel</h2>
                <div id="adminInfo" class="hidden">
                    <p>Welcome, Admin. You have access to delete NFTs and download any image.</p>
                    <p>Use the controls in the Weekly Collection tab to manage NFTs.</p>
                </div>
            </section>
        </main>

        <footer>
            <p>Doodle NFT Factory - Built on Stargaze</p>
            <div class="social-icons">
                <a href="#" class="social-icon">üê¶</a>
                <a href="#" class="social-icon">üì±</a>
                <a href="#" class="social-icon">üåü</a>
            </div>
        </footer>
    </div>

    <script type="module">
        import { WebsimSocket } from "https://esm.run/websim@0.1.3";
        window.WebsimSocket = WebsimSocket;
    </script>
    <script type="module" src="app.js"></script>
</body>
</html>